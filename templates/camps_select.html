{% extends "base.html" %}

{% block content %}
<div class="jumbotron">
    <div class="container">
        <h1>üéØ Choix du Camp</h1>
        <p class="lead">Choisissez votre camp pour participer au CTF</p>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            
            <!-- Carte principale avec toutes les infos -->
            <div class="card mb-4">
                <div class="card-body">
                    
                    <!-- Statistiques et statut actuel -->
                    {% if stats and stats.show_counts %}
                    <div class="alert alert-info mb-3">
                        <h5 class="mb-3">üìä R√©partition actuelle des √©quipes</h5>
                        <div class="row text-center">
                            <div class="col-md-6 mb-2 mb-md-0">
                                <span class="badge badge-primary p-2" style="font-size: 1.1em; color: #fff !important;">
                                    üîµ Camp Bleu : {{ stats.blue }}{% if stats.show_limits and stats.blue_max > 0 %}/{{ stats.blue_max }}{% endif %} √©quipe(s)
                                </span>
                            </div>
                            <div class="col-md-6">
                                <span class="badge badge-danger p-2" style="font-size: 1.1em; color: #fff !important;">
                                    üî¥ Camp Rouge : {{ stats.red }}{% if stats.show_limits and stats.red_max > 0 %}/{{ stats.red_max }}{% endif %} √©quipe(s)
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Statut du camp actuel -->
                    {% if current_camp %}
                    <div class="alert {% if current_camp == 'blue' %}alert-primary{% else %}alert-danger{% endif %} mb-3">
                        <h4 class="mb-0">
                            {% if current_camp == 'blue' %}
                                üîµ <strong>Votre camp actuel : Camp Bleu</strong> (D√©fenseurs)
                            {% else %}
                                üî¥ <strong>Votre camp actuel : Camp Rouge</strong> (Attaquants)
                            {% endif %}
                        </h4>
                    </div>
                    {% else %}
                    <div class="alert alert-warning mb-3">
                        <h5 class="mb-0">‚ö†Ô∏è <strong>Aucun camp s√©lectionn√©</strong></h5>
                        <p class="mb-0 mt-2">Vous devez choisir un camp pour acc√©der aux challenges !</p>
                    </div>
                    {% endif %}
                    
                    <!-- Deadline info -->
                    {% if deadline and allow_change %}
                    <div class="alert {% if can_change %}alert-warning{% else %}alert-danger{% endif %} mb-3">
                        <strong>‚è∞ {% if can_change %}Attention{% else %}Date limite d√©pass√©e{% endif %}</strong> : 
                        {% if can_change %}
                            Vous pouvez changer de camp jusqu'au <strong>{{ deadline }}</strong>
                        {% else %}
                            La date limite √©tait le <strong>{{ deadline }}</strong>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Message d'erreur si changement bloqu√© -->
                    {% if not can_change %}
                    <div class="alert alert-danger mb-3">
                        <h5>üîí <strong>Changement de camp bloqu√©</strong></h5>
                        <p class="mb-0">{{ change_error }}</p>
                    </div>
                    {% endif %}
                    
                </div>
            </div>
            
            <!-- Cartes de s√©lection de camp -->
            <div class="row">
                <!-- Camp Bleu -->
                <div class="col-md-6 mb-3">
                    <div class="card h-100 {% if current_camp == 'blue' %}border-primary{% else %}border-secondary{% endif %}" style="border-width: 2px;">
                        <div class="card-body text-center">
                            <h2 class="card-title">üîµ Camp Bleu</h2>
                            <h5 class="text-muted mb-3">D√©fenseurs</h5>
                            <p class="card-text">
                                Prot√©gez les syst√®mes et infrastructures contre les attaques.
                                Analysez les logs, renforcez la s√©curit√©, d√©tectez les intrusions.
                            </p>
                            <ul class="list-unstyled mb-4">
                                <li class="mb-1">üõ°Ô∏è Challenges de d√©fense</li>
                                <li class="mb-1">üîç Analyse forensics</li>
                                <li class="mb-1">üö® D√©tection d'incidents</li>
                            </ul>
                            
                            {% if current_camp == 'blue' %}
                                <button class="btn btn-primary btn-lg" disabled>
                                    ‚úì Camp actuel
                                </button>
                            {% elif not can_change or not can_join_blue %}
                                <button class="btn btn-secondary btn-lg" disabled>
                                    {% if not can_join_blue %}
                                        üîí Camp complet
                                        {% if stats and stats.show_counts and stats.show_limits and stats.blue_max > 0 %}
                                            (limit√© √† {{ stats.blue_max }})
                                        {% endif %}
                                    {% else %}
                                        üîí Changement bloqu√©
                                    {% endif %}
                                </button>
                            {% else %}
                                <button class="btn btn-outline-primary btn-lg" onclick="selectCamp('blue')">
                                    Rejoindre le Camp Bleu
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Camp Rouge -->
                <div class="col-md-6 mb-3">
                    <div class="card h-100 {% if current_camp == 'red' %}border-danger{% else %}border-secondary{% endif %}" style="border-width: 2px;">
                        <div class="card-body text-center">
                            <h2 class="card-title">üî¥ Camp Rouge</h2>
                            <h5 class="text-muted mb-3">Attaquants</h5>
                            <p class="card-text">
                                Exploitez les vuln√©rabilit√©s et p√©n√©trez les syst√®mes adverses.
                                Trouvez les failles, d√©veloppez des exploits, contournez les protections.
                            </p>
                            <ul class="list-unstyled mb-4">
                                <li class="mb-1">‚öîÔ∏è Challenges d'attaque</li>
                                <li class="mb-1">üíâ Exploitation de vuln√©rabilit√©s</li>
                                <li class="mb-1">üéØ Pentest offensif</li>
                            </ul>
                            
                            {% if current_camp == 'red' %}
                                <button class="btn btn-danger btn-lg" disabled>
                                    ‚úì Camp actuel
                                </button>
                            {% elif not can_change or not can_join_red %}
                                <button class="btn btn-secondary btn-lg" disabled>
                                    {% if not can_join_red %}
                                        üîí Camp complet
                                        {% if stats and stats.show_counts and stats.show_limits and stats.red_max > 0 %}
                                            (limit√© √† {{ stats.red_max }})
                                        {% endif %}
                                    {% else %}
                                        üîí Changement bloqu√©
                                    {% endif %}
                                </button>
                            {% else %}
                                <button class="btn btn-outline-danger btn-lg" onclick="selectCamp('red')">
                                    Rejoindre le Camp Rouge
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <br>
    <p style="text-align: center;">
    <a href="https://hackolyte.fr/">
      <img src="https://hackolyte.fr/wp-content/uploads/2024/09/cropped-cropped-logo.png" alt="Hack'olyte logo" style="height: 30px; vertical-align: middle; margin-right: 5px;">
    </a>
    Plugin d√©velopp√© par l'association <a href="https://hackolyte.fr/">Hack'olyte</a> - v1.0
  </p>
</div>

<script>
function selectCamp(camp) {
    if (!confirm(`√ätes-vous s√ªr de vouloir rejoindre le Camp ${camp === 'blue' ? 'Bleu' : 'Rouge'} ?`)) {
        return;
    }
    
    fetch('/api/v1/camps/select', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'CSRF-Token': window.init.csrfNonce
        },
        body: JSON.stringify({ camp: camp })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ ' + data.message);
            location.reload();
        } else {
            alert('‚ùå Erreur: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        alert('‚ùå Erreur lors de la s√©lection du camp');
    });
}
</script>
{% endblock %}
